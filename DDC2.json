[{"id":"437000c7.c01d","type":"tab","label":"DDC2 v1.172e","disabled":true,"info":""},{"id":"58731212.44ab9c","type":"inject","z":"437000c7.c01d","name":"Server Specific Settings","repeat":"","crontab":"","once":true,"onceDelay":"0.1","topic":"","payload":"false","payloadType":"bool","x":170,"y":80,"wires":[["dab3a298.12b4a"]]},{"id":"5670a49b.91070c","type":"function","z":"437000c7.c01d","name":"Set DDC2.ServerID","func":"flow.set('DDC2.ServerID', 'YOUR-SERVER-ID');\nnode.status({fill:\"green\",shape:\"dot\",text:\"DDC2.ServerID: \" +flow.get('DDC2.ServerID')});","outputs":0,"noerr":0,"initialize":"","finalize":"","x":630,"y":180,"wires":[],"icon":"node-red/cog.svg"},{"id":"2d653647.9faa7a","type":"function","z":"437000c7.c01d","name":"Set DDC2.HostedBy","func":"flow.set('DDC2.HostedBy.Name', 'YourName');\nflow.set('DDC2.HostedBy.DiscordID','<@>');\nflow.set('DDC2.HostedBy.DNSName', 'Your Domain Name or IP');\nnode.status({fill:\"green\",shape:\"dot\",text:\"DDC2.HostedBy: \" +flow.get('DDC2.HostedBy.Name')});","outputs":0,"noerr":0,"initialize":"","finalize":"","x":640,"y":60,"wires":[],"icon":"node-red/cog.svg"},{"id":"434e2ff.3e665d","type":"function","z":"437000c7.c01d","name":"Set DDC2.HostedBy.ISP","func":"flow.set('DDC2.HostedBy.ISP.Name', 'ENTER_YOUR_ISP');\nflow.set('DDC2.HostedBy.ISP.Speed', 'ENTER_YOUR_CONNECTION_SPEED');\nnode.status({fill:\"green\",shape:\"dot\",text:\"DDC2.HostedBy.ISP: \" +flow.get('DDC2.HostedBy.ISP.Name')});","outputs":0,"noerr":0,"initialize":"","finalize":"","x":650,"y":120,"wires":[],"icon":"node-red/cog.svg"},{"id":"1f5ad26c.f6ca1e","type":"function","z":"437000c7.c01d","name":"Set DDC2.ServerDT","func":"flow.set('DDC2.ServerDT', 'Daily at 0630-0645 AEST');\nnode.status({fill:\"green\",shape:\"dot\",text:\"DDC2.ServerDT: \" +flow.get('DDC2.ServerDT')});","outputs":0,"noerr":0,"initialize":"","finalize":"","x":640,"y":240,"wires":[],"icon":"node-red/cog.svg"},{"id":"103b3017.99df3","type":"switch","z":"437000c7.c01d","name":"Request Type","property":"message.request","propertyType":"msg","rules":[{"t":"eq","v":"!report","vt":"str"},{"t":"eq","v":"!start","vt":"str"},{"t":"eq","v":"!restart","vt":"str"},{"t":"eq","v":"!update","vt":"str"},{"t":"eq","v":"!autostart","vt":"str"},{"t":"eq","v":"!access","vt":"str"},{"t":"eq","v":"!secure","vt":"str"},{"t":"eq","v":"!stop","vt":"str"},{"t":"eq","v":"!status","vt":"str"},{"t":"eq","v":"!lock","vt":"str"},{"t":"eq","v":"!unlock","vt":"str"},{"t":"eq","v":"!radio","vt":"str"}],"checkall":"false","repair":false,"outputs":12,"x":1080,"y":640,"wires":[["8404258a.0d3358"],["8404258a.0d3358"],["8404258a.0d3358"],["8404258a.0d3358"],["8404258a.0d3358"],["e6c50dc2.01a85"],["e6c50dc2.01a85"],["57b168e.e21ca98"],["57b168e.e21ca98"],[],[],[]],"inputLabels":["Discord Message"],"outputLabels":["!report","!start","!restart","!update","","!access","","!stop","!status","","",null],"icon":"font-awesome/fa-map-signs"},{"id":"8588ef16.4c8cc","type":"function","z":"437000c7.c01d","name":"CNC-CORE-LOGIC","func":"/*\nThis Node unpacks the msg and does a check that this server is the intended recipient of the message\n*/\n//Moving Message Payload\n\n////////////////////////////////////////////////////////////////////////////////////////////////////\n////Initialize Variables\n//Get Flow Variables\nvar DDC2 = flow.get('DDC2');\nvar perms = DDC2.Permissions;\n//Get Message Variables\nvar usrname = msg.author.username;\nvar discordID = msg.author.id;\nvar message = msg.payload;\nvar DiscordRoles = msg.member._roles;\nvar tmstmp = msg.data.createdTimestamp;\nvar localdatetime = (new Date(tmstmp)).toLocaleString();\n//Messge Breakdown\n    var msglow = message.toLowerCase();\n    var splitmsg = msglow.split(\" \",3);\n    var command = splitmsg[0];\n    var server = splitmsg[1];\n    \n    //Setting new Variables\n    msg.message = {\n        \"request\" : command,\n          \"valid\" : false,\n            \"raw\" : msg.payload\n    }\n    \n    var payloaderror = \"Invalid Request recieved: \" +command;\n    var payload = \"\";\n    \n    ////////////////////////////////////////////////////////////////////////////////////////////////////\n    ////Functions\n    /**\n     * @description determine if an array contains one or more items from another array.\n     * @param {array} haystack the array to search.\n     * @param {array} arr the array providing items to check for in the haystack.\n     * @return {boolean} true|false if haystack contains at least one item from arr.\n     */\n    var GrantAccess = function (haystack, arr) {\n        return arr.some(function (v) {\n            return haystack.indexOf(v) >= 0;\n        });\n    };\n    ////////////////////////////////////////////////////////////////////////////////////////////////////\n    \n    \n    if (command == \"!test\") { //All Servers should respond to a test command\n        if (GrantAccess(perms.test,DiscordRoles)) {\n            msg.payload = usrname+\" test message was successfully recieved by server \"+DDC2.ServerID;\n            msg.message.authorized = true;\n            msg.message.valid = true;\n            }\n        else {\n            msg.payload = usrname+\", Access Denied for !test command on server \"+DDC2.ServerID;\n            msg.message.authorized = false;\n            msg.message.valid = true;\n            }\n        if(msg.message.authorized) {return [null,msg,msg]} else {return [null,msg,msg]}\n        }\n    \n    if (server == DDC2.ServerID.toLowerCase()) { //Server ID Check (is this the server the message is looking for?)\n        if (message.charAt(0) == '!') { //This message is a command request\n            payload = payloaderror;\n            msg.message.valid = false;\n            msg.message.request = command;\n            msg.message.server = server;\n           /////////////////////////////////////////////////\n            if (command == \"!info\") {\n                if (GrantAccess(perms.info,DiscordRoles)) {\n                    payload = \"-info\"; //PLACE HOLDER UNTIL INFO TASK BUILT\n                    msg.payload = payload;\n                    msg.message.authorized = true;\n                    msg.message.valid = true;    \n                    return [null,msg,msg,msg];\n                    }\n                else {\n                    msg.message.User = usrname;\n                    msg.message.valid = true;\n                    msg.message.DiscordID = discordID;\n                    return [null,msg,msg,msg];\n                    }\n                }\n            /////////////////////////////////////////////////\n            if (command == \"!status\") {\n                if (GrantAccess(perms.statusV,DiscordRoles)) {\n                    payload = \"-status\";      \n                    msg.payload = payload;\n                    msg.message.authorized = true;\n                    msg.message.valid = true;    \n                    return [msg,msg,msg,null];\n                    }\n                else {\n                    msg.message.valid = true;\n                    return [null,msg,msg,null];\n                    }\n                }\n            /////////////////////////////////////////////////\n            if (command == \"!report\") {\n                if (GrantAccess(perms.report,DiscordRoles)) {\n                    payload = \"-report\";      \n                    msg.payload = payload;\n                    msg.message.authorized = true;\n                    msg.message.valid = true;    \n                    return [msg,msg,msg,null];\n                    }\n                else {\n                    msg.message.User = usrname;\n                    msg.message.valid = true;\n                    msg.message.DiscordID = discordID;\n                    return [null,msg,msg,null];\n                    }\n                }\n            /////////////////////////////////////////////////\n            if (command == \"!start\") {\n                if (GrantAccess(perms.start,DiscordRoles)) {\n                    payload = \"-start\";      \n                    msg.payload = payload;\n                    msg.message.authorized = true;\n                    msg.message.valid = true;    \n                    return [msg,msg,msg,null];\n                    }\n                else {\n                    msg.message.User = usrname;\n                    msg.message.valid = true;\n                    msg.message.DiscordID = discordID;\n                    return [null,msg,msg,null];\n                    }\n                }\n            /////////////////////////////////////////////////\n            if (command == \"!stop\") {\n                if (GrantAccess(perms.stop,DiscordRoles)) {\n                    payload = \"-stop\";      \n                    msg.payload = payload;\n                    msg.message.authorized = true;\n                    msg.message.valid = true;    \n                    return [msg,msg,msg,null];\n                    }\n                else {\n                    msg.message.User = usrname;\n                    msg.message.valid = true;\n                    msg.message.DiscordID = discordID;\n                    return [null,msg,msg,null];\n                    }\n                }\n            /////////////////////////////////////////////////\n            if (command == \"!restart\") {\n                if (GrantAccess(perms.restart,DiscordRoles)) {\n                    payload = \"-restart\";      \n                    msg.payload = payload;\n                    msg.message.authorized = true;\n                    msg.message.valid = true;    \n                    return [msg,msg,msg,null];\n                    }\n                else {\n                    msg.message.User = usrname;\n                    msg.message.valid = true;\n                    msg.message.DiscordID = discordID;\n                    return [null,msg,msg,null];\n                    }\n                }\n            /////////////////////////////////////////////////\n            if (command == \"!update\") {\n                if (GrantAccess(perms.update,DiscordRoles)) {\n                    payload = \"-update\";      \n                    msg.payload = payload;\n                    msg.message.authorized = true;\n                    msg.message.valid = true;    \n                    return [msg,msg,msg,null];\n                    }\n                else {\n                    msg.message.User = usrname;\n                    msg.message.valid = true;\n                    msg.message.DiscordID = discordID;\n                    return [null,msg,msg,null];\n                    }\n                }\n            /////////////////////////////////////////////////\n            if (command == \"!reboot\") {\n                if (GrantAccess(perms.reboot,DiscordRoles)) {\n                    payload = \"-reboot\";      \n                    msg.payload = payload;\n                    msg.message.authorized = true;\n                    msg.message.valid = true;    \n                    return [msg,msg,msg,null];\n                    }\n                else {\n                    msg.message.User = usrname;\n                    msg.message.valid = true;\n                    msg.message.DiscordID = discordID;\n                    return [null,msg,msg,null];\n                    }\n                }\n/////////////////////////////////////////////////\nif (command == \"!access\") {\n    if (GrantAccess(perms.access,DiscordRoles)) {\n        if (DDC2.VNC.Enabled) {\n            payload = `-access -IP `+splitmsg[2]+` -USER `+usrname+` -ID `+discordID+ ` -VNC`;\n            }\n        else {\n            payload = `-access -IP `+splitmsg[2]+` -USER `+usrname+` -ID `+discordID;\n            }\n        msg.payload = payload;\n        msg.message.authorized = true;\n        msg.message.valid = true;\n        msg.message.IP = splitmsg[2];\n        if (typeof msg.message.IP === 'undefined') {\n            msg.message.User = usrname;\n            msg.message.valid = false;\n            msg.message.DiscordID = discordID;\n            msg.message.commentLog = `!access request was missing IP address`\n            msg.message.comment = ` \\`\\`\\``+DDC2.ServerID+ ` received an invalid request (`+msg.message.request+`) request. (Missing IP Address)\n\nNOTE: Please use the following syntax: !access `+DDC2.ServerID+` <IPv4Address>\n            \nRequest recieved from ` +usrname+ ` at `+localdatetime+`\\`\\`\\` **Note: Access Information will only appear in the admin channel**`\n            return [null,msg,msg,null];    \n            }\n        else {\n            msg.message.User = usrname;\n            msg.message.valid = true;\n            msg.message.DiscordID = discordID;\n            return [msg,msg,msg,null];    \n            }\n        }\n    else {\n        msg.message.User = usrname;\n        msg.message.valid = true;\n        msg.message.DiscordID = discordID;\n        return [null,msg,msg,null];\n        }\n    }\n/////////////////////////////////////////////////\n}\n}","outputs":4,"noerr":0,"initialize":"","finalize":"","x":400,"y":860,"wires":[["9c4c4ff.f7d2ab"],["56987732.756ed8"],["20dc435a.cec5ac"],["49085ac0.d88b74","774b8554.fbe1bc","67df55ee.db418c"]],"inputLabels":["Post-Whitelist-Check"],"outputLabels":["Process Request","Start Message","Log","!info"]},{"id":"14cdb103.e77c3f","type":"function","z":"437000c7.c01d","name":"Set DDC2.Permissions","func":"var InfoGrpID = \"YOUR INFO ID\"; //- (Info Only User Group)\nvar PwrUsrsID = \"YOUR POWER USERS ID\"; //- (Server Power User Group)\nvar AdmUsrsID = \"YOUR ADMIN ID\"; //- (Server Admin User Group)\n\n//Setting Up Permission Arrays\n\nvar InfoPermArr = [InfoGrpID, PwrUsrsID, AdmUsrsID];\nvar PowrPermArr = [PwrUsrsID, AdmUsrsID];\nvar AdmnPermArr = [AdmUsrsID];\n\n\n//Basic Info Only Commands\nflow.set('DDC2.Permissions.test', InfoPermArr);\nflow.set('DDC2.Permissions.info', InfoPermArr);\n\n//Power User Commands\nflow.set('DDC2.Permissions.report', PowrPermArr);\nflow.set('DDC2.Permissions.statusV', PowrPermArr);\nflow.set('DDC2.Permissions.start', PowrPermArr);\nflow.set('DDC2.Permissions.stop', PowrPermArr);\nflow.set('DDC2.Permissions.restart', PowrPermArr);\n\n//Administrator Commands\nflow.set('DDC2.Permissions.update', AdmnPermArr);\nflow.set('DDC2.Permissions.reboot', AdmnPermArr);\nflow.set('DDC2.Permissions.access', AdmnPermArr);\n\nnode.status({fill:\"green\",shape:\"dot\",text:\"DDC2.Permissions: SET\"});","outputs":0,"noerr":0,"initialize":"","finalize":"","x":640,"y":300,"wires":[],"icon":"node-red/cog.svg"},{"id":"dab3a298.12b4a","type":"change","z":"437000c7.c01d","name":"Clear ALL Variables","rules":[{"t":"delete","p":"DDC2","pt":"flow"}],"action":"","property":"","from":"","to":"","reg":false,"x":390,"y":60,"wires":[["2d653647.9faa7a","434e2ff.3e665d","5670a49b.91070c","1f5ad26c.f6ca1e","14cdb103.e77c3f","e7b508ac.33ec88","651b8eeb.b9907","3c11b840.b78858"]]},{"id":"56987732.756ed8","type":"function","z":"437000c7.c01d","name":"Start Task MSG","func":"var MsgSent = context.get('MsgSent') || 1;\nvar DDC2 = flow.get('DDC2');\nvar usrname = msg.author.username;\nvar tmstmp = msg.data.createdTimestamp;\nvar localdatetime = (new Date(tmstmp)).toLocaleString();\nvar newmessage = \"\";\nvar access = \"DENIED\";\nif (msg.message.authorized) {access = \"GRANTED\"}\n//FUNCTIONS////////////////////////////////////////////////////////////////////////////\nfunction pad(num, size) {\n    var s = num+\"\";\n    while (s.length < size) s = \"0\" + s;\n    return s;\n}\nvar accessDENIED = ` \\`\\`\\`!!ACCESS DENIED!! ` +usrname+ ` you do not have access to the `+msg.message.request+` command on server `+DDC2.ServerID+ `, message ignored at `+localdatetime+ ` \\`\\`\\` `\n//END//FUNCTIONS///////////////////////////////////////////////////////////////////////\nif(msg.message.valid) {\n    if(msg.message.request == \"!test\") {\n        if(msg.message.authorized) {\n            newmessage = ` \\`\\`\\``+DDC2.ServerID+ ` successfully received test message from ` +usrname+ ` at `+localdatetime+ ` \\`\\`\\` `\n            }\n        else {\n            newmessage = accessDENIED;\n            }\n        msg.payload = newmessage;\n        }\n    ///////////////////////////////////////////////////////////////////////\n    if(msg.message.request == \"!info\") {\n        if(msg.message.authorized) {\n            newmessage = ` \\`\\`\\``+DDC2.ServerID+ ` has received your request `+usrname+ ` and has begun processing your Info request, please wait.... \\`\\`\\` `\n            }\n        else {\n            newmessage = accessDENIED;\n            }\n        msg.payload = newmessage;\n        }\n    ///////////////////////////////////////////////////////////////////////\n    if(msg.message.request == \"!status\") {\n        if(msg.message.authorized) {\n            newmessage = ` \\`\\`\\``+DDC2.ServerID+ ` has received your request `+usrname+ ` and has begun processing your Status request, please wait.... \\`\\`\\` `\n            }\n        else {\n            newmessage = accessDENIED;\n            }\n        msg.payload = newmessage;\n        }\n    ///////////////////////////////////////////////////////////////////////    \n    if(msg.message.request == \"!report\") {\n        if(msg.message.authorized) {\n            newmessage = ` \\`\\`\\``+DDC2.ServerID+ ` has received your request `+usrname+ ` and has begun processing your Report request, please wait.... \\`\\`\\` **Note: Report Information will only appear in the admin channel**`\n            }\n        else {\n            newmessage = accessDENIED;\n            }\n        msg.payload = newmessage;\n        }\n    ///////////////////////////////////////////////////////////////////////\n    if(msg.message.request == \"!start\") {\n        if(msg.message.authorized) {\n            newmessage = ` \\`\\`\\``+DDC2.ServerID+ ` has received your request `+usrname+ ` and has begun processing your Start request, please wait.... \\`\\`\\` `\n            }\n        else {\n            newmessage = accessDENIED;\n            }\n        msg.payload = newmessage;\n        } \n    ///////////////////////////////////////////////////////////////////////\n    if(msg.message.request == \"!stop\") {\n        if(msg.message.authorized) {\n            newmessage = ` \\`\\`\\``+DDC2.ServerID+ ` has received your request `+usrname+ ` and has begun processing your Stop request, please wait.... \\`\\`\\` `\n            }\n        else {\n            newmessage = accessDENIED;\n            }\n        msg.payload = newmessage;\n        }\n    ///////////////////////////////////////////////////////////////////////\n    if(msg.message.request == \"!restart\") {\n        if(msg.message.authorized) {\n            newmessage = ` \\`\\`\\``+DDC2.ServerID+ ` has received your request `+usrname+ ` and has begun processing your Restart request, please wait.... \\`\\`\\` `\n            }\n        else {\n            newmessage = accessDENIED;\n            }\n        msg.payload = newmessage;\n        }\n    ///////////////////////////////////////////////////////////////////////\n    if(msg.message.request == \"!update\") {\n        if(msg.message.authorized) {\n            newmessage = ` \\`\\`\\``+DDC2.ServerID+ ` has received your request `+usrname+ ` and has begun processing your Update request, please wait.... \\`\\`\\` `\n            }\n        else {\n            newmessage = accessDENIED;\n            }\n        msg.payload = newmessage;\n        }\n    ///////////////////////////////////////////////////////////////////////\n    if(msg.message.request == \"!reboot\") {\n        if(msg.message.authorized) {\n            newmessage = ` \\`\\`\\``+DDC2.ServerID+ ` has received your request `+usrname+ ` and has begun processing your Reboot request, please wait.... \\`\\`\\` `\n            }\n        else {\n            newmessage = accessDENIED;\n            }\n        msg.payload = newmessage;\n        }\n    ///////////////////////////////////////////////////////////////////////\n    if(msg.message.request == \"!access\") {\n        if(msg.message.authorized) {\n            newmessage = ` \\`\\`\\``+DDC2.ServerID+ ` has received your request `+usrname+ ` and has begun processing your Access request, please wait.... \\`\\`\\` **Note: Access Information will only appear in the admin channel**`\n            }\n        else {\n            newmessage = accessDENIED;\n            }\n        msg.payload = newmessage;\n        }\n    ///////////////////////////////////////////////////////////////////////\n    if(msg.message.request == \"!autostart\") {\n        if(msg.message.authorized) {\n            newmessage = ` \\`\\`\\``+DDC2.ServerID+ ` has initialized a self AutoStart at `+localdatetime+ ` \\`\\`\\` `\n            }\n        else {\n            newmessage = accessDENIED;\n            }\n        msg.payload = newmessage;\n        }\n    }\nelse \n    {\n    newmessage = ` \\`\\`\\``+DDC2.ServerID+ ` received an invalid request (`+msg.message.request+`) from ` +usrname+ ` at `+localdatetime+ ` \\`\\`\\` `\n    if (!(typeof msg.message.comment === 'undefined')) {newmessage = msg.message.comment}\n    msg.payload = newmessage;\n    }\n\nreturn msg;","outputs":1,"noerr":0,"initialize":"","finalize":"","x":1280,"y":780,"wires":[["26937249.88bcee"]],"inputLabels":["CnC-CORE"],"outputLabels":["Server-Status"],"icon":"node-red/envelope.svg"},{"id":"20dc435a.cec5ac","type":"function","z":"437000c7.c01d","name":"Send Log MSG","func":"var MsgSent = context.get('MsgSent') || 1;\nvar DDC2 = flow.get('DDC2');\nvar usrname = msg.author.username;\nvar tmstmp = msg.data.createdTimestamp;\nvar localdatetime = (new Date(tmstmp)).toLocaleString();\nvar newmessage = \"\";\nvar access = \"DENIED\";\nif (msg.message.authorized) {access = \"GRANTED\"}\n//LOG/SECTION//////////////////////////////////////////////////////////////////////////\nvar logmsg = ``;\nvar commentLog = ``;\nif(msg.message.valid) {\n    if (!(typeof msg.message.commentLog === 'undefined')) {commentLog = msg.message.commentLog} else {commentLog = `Request Received`}\n    logmsg = ` \\`\\`\\`    TimeStamp: ` +localdatetime+ `\n     RequestID: `+msg._msgid+`\n     Requestor: `+usrname+ `\n  Request Type: ` +msg.message.request+ `\n       Raw Msg: `+msg.message.raw+`\n     Responder: ` +DDC2.ServerID+ `\n        Access: ` +access+ `\n      Comments: `+commentLog+` \\`\\`\\` `\n    }\nelse {\n    if (!(typeof msg.message.commentLog === 'undefined')) {commentLog = msg.message.commentLog} else {commentLog = msg.message.request+` is not a valid request`}\n    logmsg = ` \\`\\`\\`     TimeStamp: ` +localdatetime+ `\n       RequestID: `+msg._msgid+`\n         Raw Msg: `+msg.message.raw+`\n       Requestor: `+usrname+ `\n    Request Type: ` +msg.message.request+ `\n       Responder: ` +DDC2.ServerID+ `\n          Access: ` +access+ `\n        Comments: `+commentLog+` \\`\\`\\` `\n    }\n//END/LOG/SECTION//////////////////////////////////////////////////////////////////////\nvar LogChan = {\n    \"id\": DDC2.Channel.Log\n    }\nvar logsend = {\n    \"payload\": logmsg,\n    \"channel\": LogChan\n    }\nnode.status({fill:\"green\",shape:\"ring\",text: \"Log Entries Sent: \"+MsgSent});\ncontext.set('MsgSent', (MsgSent + 1));\nreturn logsend;","outputs":1,"noerr":0,"initialize":"","finalize":"","x":1320,"y":900,"wires":[["26937249.88bcee"]],"inputLabels":["CnC-CORE"],"outputLabels":["Server-Status"],"icon":"node-red/envelope.svg"},{"id":"9c4c4ff.f7d2ab","type":"exec","z":"437000c7.c01d","command":"C:\\Windows\\System32\\WindowsPowerShell\\v1.0\\powershell.exe -ExecutionPolicy Bypass -File \"G:\\GameServer\\DDC2\\ddc2.ps1\"","addpay":true,"append":"","useSpawn":"false","timer":"","oldrc":false,"name":"PowerShell","x":610,"y":660,"wires":[["a04d74da.e28ce8"],[],[]],"inputLabels":["Input"],"outputLabels":["Standard Out","Error Out","Returned Values"],"icon":"font-awesome/fa-file-powerpoint-o"},{"id":"49085ac0.d88b74","type":"function","z":"437000c7.c01d","name":"!info Admin","func":"var MsgSent = context.get('MsgSent') || 1;\nvar DDC2 = flow.get('DDC2');\nvar usrname = msg.author.username; \nvar responsee = (msg.author.id === DDC2.ServerID) ? msg.author.id : \"<@\"+msg.author.id+\">\" \n//FUNCTIONS////////////////////////////////////////////////////////////////////////////\nfunction pad(num, size) {\n    var s = num+\"\";\n    while (s.length < size) s = \"0\" + s;\n    return s;\n}\nDate.daysBetween = function( date1, date2 ) {\n  var one_day=1000*60*60*24;\n  var date1_ms = date1.getTime();\n  var date2_ms = date2.getTime();\n  var difference_ms = date2_ms - date1_ms;\n  difference_ms = Math.round(difference_ms/1000,3);\n  var mseconds = difference_ms % 1000;\n  var seconds = Math.floor(difference_ms % 60);\n  difference_ms = difference_ms/60; \n  var minutes = Math.floor(difference_ms % 60);\n  difference_ms = difference_ms/60; \n  var hours = Math.floor(difference_ms % 24);  \n  var days = Math.floor(difference_ms/24);\n  return pad(minutes,2) + ':' + pad(seconds,2) + '.' + pad(mseconds,3);\n}\nfunction GetPriority(priority) {\nvar PriorityTable = { 64:\"Low\", \n                   16384:\"Below Normal\", \n                      32:\"Normal\", \n                   32768:\"Above Normal\", \n                     128:\"High\",\n\t\t\t\t\t 256:\"Realtime\"\n\t\t\t\t\t};\nreturn (PriorityTable[priority])\n}\n//END//FUNCTIONS///////////////////////////////////////////////////////////////////////\n\nif(msg.channel.id == DDC2.Channel.Admin) {\nvar request = msg.message.request; \nif(request == \"!info\") {\nvar localdatetime = (new Date(msg.data.createdTimestamp)).toLocaleString();\nvar InfoOK = DDC2.Info.Bool;\nvar serverMSG = ``;\nif(InfoOK) {\n    var tmstmp = DDC2.Info.TimeStamp\n    var ttc = Date.daysBetween((new Date(msg.data.createdTimestamp)), new Date());\n    var reportage = Date.daysBetween((new Date(tmstmp)), new Date());\n    var reportdatetime = (new Date(tmstmp)).toLocaleString();\n    var PS = flow.get('DDC2.Info.PS');\n////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////\n////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////        \n//GAME PROCESSES////////////////////////////////////////////////////////////////////////////////////////////////////////\n////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////\n//DCS\nvar dcsok = \"OFFLINE\";\nvar dcs = \"\";\n    if(PS.Status.Game.DCS.IsActive) {if(PS.Status.Game.DCS.Responding) {dcsok = `OK`} else {dcsok = `NOT RESPONDING`}}\n        dcs = `\n              #### DCS   INFO ####\n     DCS Server Status : `+dcsok+`\n    InGame Server Name : `+PS.Details.Config.DCS.ServerName+`\n               Version : `+PS.Details.Config.DCS.Version+`\n           Server Port : `+PS.Details.Config.DCS.Port+`\n              Password : `+PS.Details.Config.DCS.Passwrd+`\n      Max Ping Allowed : `+PS.Details.Config.DCS.MaxPing+`ms\n\n          ##### LotATC   INFO ####\n        LotATC Version : `+PS.Details.Config.LotATC.Version+`\n           LotATC Port : `+PS.Details.Config.LotATC.Port+`\n              Blue Pwd : `+PS.Details.Config.LotATC.BluPWD+`\n               Red Pwd : `+PS.Details.Config.LotATC.RedPWD+`\n\n          #### TACview   INFO ####\n               Version : `+PS.Details.Config.Tacview.Version+`\n          TACview Port : `+PS.Details.Config.DCS.Port+`\n                 Delay : `+PS.Details.Config.Tacview.Delay+`\n            Client Pwd : `+PS.Details.Config.Tacview.ClientPWD\n////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////        \n//SRS            \nvar srsok = \"OFFLINE\";\nvar srs = \"\";\n    if(PS.Status.Game.SRS.IsActive) {if(PS.Status.Game.SRS.Responding) {srsok = `OK`} else {srsok = `NOT RESPONDING`}}\n        srs = `\n              #### SRS   INFO ####\n                Status : `+srsok+`\n               Version : `+PS.Details.Config.SRS.Version+`\n           Server Port : `+PS.Details.Config.SRS.Port+`\n              Blue Pwd : `+PS.Details.Config.SRS.BluPWD+`\n               Red Pwd : `+PS.Details.Config.SRS.RedPWD\n\n    serverMSG = `\n           #### SERVER   INFO ####\n             DDC2 Name : `+DDC2.ServerID+`\n       Server DownTime : `+DDC2.ServerDT+`\n             Server IP : `+PS.Details.Info.IPAddr+`\n      Last Report Done : `+reportdatetime+`\n              Data Age : `+reportage\n    }\nelse {\n    serverMSG = `No variables currently set, please run a !report to populate flow variables`\n    }\n\nvar transmit = `Requested by `+responsee+` \\`\\`\\`ADMIN CAHCED INFO REPORT for ` +DDC2.ServerID+ ` as at ` +localdatetime+`\n `+serverMSG+` \n `+dcs+`\n `+srs+`\n \\`\\`\\`*Request completed in `+ttc+`*` \n//LOG/SECTION//////////////////////////////////////////////////////////////////////////\nvar access = \"DENIED\";\nif (msg.message.authorized) {access = \"GRANTED\"}\nvar LogChan = {\n    \"id\": DDC2.Channel.Log\n    }\nvar logmsg = ` \\`\\`\\`    TimeStamp: ` +localdatetime+ `\n     RequestID: `+msg._msgid+`\n     Requestor: `+usrname+ `\n  Request Type: ` +msg.message.request+ `\n       Raw Msg: `+msg.message.raw+`\n     Responder: ` +DDC2.ServerID+ `\n        Access: ` +access+ `\n      Comments: Request completed in `+ttc+`\\`\\`\\` `\nvar logsend = {\n    \"payload\": logmsg,\n    \"channel\": LogChan\n    };\n//TRANSMIT/SECTION/////////////////////////////////////////////////////////////////////\nmsg.payload = transmit\n\nnode.status({fill:\"green\",shape:\"ring\",text: \"Reports Sent: \"+MsgSent});\ncontext.set('MsgSent', (MsgSent + 1));\n\nreturn [[msg],[logsend]];\n    }\n}","outputs":2,"noerr":0,"initialize":"","finalize":"","x":1330,"y":960,"wires":[["26937249.88bcee"],["26937249.88bcee"]],"inputLabels":["Powershell Output"],"outputLabels":["Server-Status","Server-Log"],"icon":"node-red/envelope.svg"},{"id":"8404258a.0d3358","type":"function","z":"437000c7.c01d","name":"!report Admin MSG","func":"var MsgSent = context.get('MsgSent') || 1;\nvar DDC2 = flow.get('DDC2');\nvar usrname = msg.author.username; \nvar responsee = (msg.author.id === DDC2.ServerID) ? msg.author.id : \"<@\"+msg.author.id+\">\" \n//var responsee = if (msg.author.id != DCSCNC.ServerID) {\"<@\"+msg.author.id+\">\"} else {msg.author.id};\n//var responsee = \"<@\"+msg.author.id+\">\"; \nvar request = msg.message.request; \n\nvar tmstmp = msg.data.createdTimestamp;\nvar localdatetime = (new Date(tmstmp)).toLocaleString();\n\n//FUNCTIONS////////////////////////////////////////////////////////////////////////////\nfunction pad(num, size) {\n    var s = num+\"\";\n    while (s.length < size) s = \"0\" + s;\n    return s;\n}\nDate.daysBetween = function( date1, date2 ) {\n  var one_day=1000*60*60*24;\n  var date1_ms = date1.getTime();\n  var date2_ms = date2.getTime();\n  var difference_ms = date2_ms - date1_ms;\n  difference_ms = Math.round(difference_ms/1000,3);\n  var mseconds = difference_ms % 1000;\n  var seconds = Math.floor(difference_ms % 60);\n  difference_ms = difference_ms/60; \n  var minutes = Math.floor(difference_ms % 60);\n  difference_ms = difference_ms/60; \n  var hours = Math.floor(difference_ms % 24);  \n  var days = Math.floor(difference_ms/24);\n  return pad(minutes,2) + ':' + pad(seconds,2) + '.' + pad(mseconds,3);\n}\nfunction GetPriority(priority) {\nvar PriorityTable = { 64:\"Low\", \n                   16384:\"Below Normal\", \n                      32:\"Normal\", \n                   32768:\"Above Normal\", \n                     128:\"High\",\n\t\t\t\t\t 256:\"Realtime\"\n\t\t\t\t\t};\nreturn (PriorityTable[priority])\n}\n//END//FUNCTIONS///////////////////////////////////////////////////////////////////////\nif((request == \"!report\") || (request == \"!start\") || (request == \"!restart\") || (request == \"!update\") || (request == \"!autostart\")) {\nflow.set('DDC2.Info.PS',msg.PS);\nflow.set('DDC2.Info.Bool',true);\nflow.set('DDC2.Info.TimeStamp',tmstmp);\nvar ttc = Date.daysBetween((new Date(tmstmp)), new Date());\n//SERVER DETAILS\nvar serverMSG = `\n           #### SERVER   INFO ####\n             DDC2 Name : `+DDC2.ServerID+`\n       Windows Version : `+msg.PS.Details.Info.WinVer+`\n              CPU Type : `+msg.PS.Details.Info.CPUType+`\n             Total RAM : `+msg.PS.Details.Info.TotalMem+`GB\n         Server UpTime : `+pad(msg.PS.Details.Info.UpTime.Days,2)+ `:`+pad(msg.PS.Details.Info.UpTime.Hours,2)+`:`+pad(msg.PS.Details.Info.UpTime.Minutes,2)+`:`+pad(msg.PS.Details.Info.UpTime.Seconds,2)+`\n       Server DownTime : `+DDC2.ServerDT+`\n             Server IP : `+msg.PS.Details.Info.IPAddr+`\n      Server ISP Speed : `+DDC2.HostedBy.ISP.Speed+`\n            Server ISP : `+DDC2.HostedBy.ISP.Name+`\n   Remote Desktop Port : `+msg.PS.Details.Info.RDPport+`\n      Server Hosted By : `+DDC2.HostedBy.Name+`\n           Memory Load : `+msg.PS.Details.Info.MEMLoad+` %\n              CPU Load : `+msg.PS.Details.Info.CPULoad+` %`\n////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////\n//UPDATERS//////////////////////////////////////////////////////////////////////////////////////////////////////////////\n////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////\n//DCS Updater\nvar dcsUpdateok = \"INACTIVE\";\nvar dcsUpdate = \"\";\n    if(msg.PS.Status.Update.DCS_updater.IsActive) {\n\t\tif(msg.PS.Status.Update.DCS_updater.Responding) {dcsUpdateok = `RUNNING`} else {dcsUpdateok = `NOT RESPONDING`}\n    dcsUpdate = `\n           #### UPDATE   INFO ####\n\n     DCS Update Status : `+dcsUpdateok+`\n      DCS Update Ticks : `+msg.PS.Status.Update.DCS_updater.Ticks+`\n       DCS Update Time : `+pad(msg.PS.Status.Update.DCS_updater.RunTime.Days,2)+ `:`+pad(msg.PS.Status.Update.DCS_updater.RunTime.Hours,2)+`:`+pad(msg.PS.Status.Update.DCS_updater.RunTime.Minutes,2)+`:`+pad(msg.PS.Status.Update.DCS_updater.RunTime.Seconds,2)\n        }\n    else {\n      dcsUpdate = `\n           #### UPDATE   INFO ####\n           \n     DCS Update Status : `+dcsUpdateok\n        }\n////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////\n//SRS Updater\nvar srsUpdateok = \"INACTIVE\";\nvar srsUpdate = \"\";\n    if(msg.PS.Status.Update.SRS_Updater.IsActive) {\n\t\tif(msg.PS.Status.Update.SRS_updater.Responding) {srsUpdateok = `RUNNING`} else {srsUpdateok = `NOT RESPONDING`}\n    srsUpdate = `\n     SRS Update Status : `+srsUpdateok+`\n      SRS Update Ticks : `+msg.PS.Status.Update.SRS_updater.Ticks+`\n       SRS Update Time : `+pad(msg.PS.Status.Update.SRS_updater.RunTime.Days,2)+ `:`+pad(msg.PS.Status.Update.SRS_updater.RunTime.Hours,2)+`:`+pad(msg.PS.Status.Update.SRS_updater.RunTime.Minutes,2)+`:`+pad(msg.PS.Status.Update.SRS_updater.RunTime.Seconds,2)\n        }\n    else {\n      srsUpdate = `\n     SRS Update Status : `+srsUpdateok\n        }\n////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////\n//LotATC Updater\nvar lotUpdateok = \"INACTIVE\";\nvar lotUpdate = \"\";\n    if(msg.PS.Status.Update.LOT_Updater.IsActive) {\n\t\tif(msg.PS.Status.Update.LOT_updater.Responding) {lotUpdateok = `RUNNING`} else {lotUpdateok = `NOT RESPONDING`}\n    lotUpdate = `\n  LotATC Update Status : `+lotUpdateok+`\n   LotATC Update Ticks : `+msg.PS.Status.Update.LOT_updater.Ticks+`\n    LotATC Update Time : `+pad(msg.PS.Status.Update.LOT_updater.RunTime.Days,2)+ `:`+pad(msg.PS.Status.Update.LOT_updater.RunTime.Hours,2)+`:`+pad(msg.PS.Status.Update.LOT_updater.RunTime.Minutes,2)+`:`+pad(msg.PS.Status.Update.LOT_updater.RunTime.Seconds,2)\n        }\n    else {\n      lotUpdate = `\n  LotATC Update Status : `+lotUpdateok\n        }\n////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////\n////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////        \n//GAME PROCESSES////////////////////////////////////////////////////////////////////////////////////////////////////////\n////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////\n//DCS\nvar dcsok = \"OFFLINE\";\nvar dcs = \"\";\n    if(msg.PS.Status.Game.DCS.IsActive) {\n\t\tif(msg.PS.Status.Game.DCS.Responding) {dcsok = `OK`} else {dcsok = `NOT RESPONDING`}\n        dcs = `\n              #### DCS   INFO ####\n     DCS Server Status : `+dcsok+`\n    InGame Server Name : `+msg.PS.Details.Config.DCS.ServerName+`\n               Version : `+msg.PS.Details.Config.DCS.Version+`\n            DCS UpTime : `+pad(msg.PS.Status.Game.DCS.RunTime.Days,2)+ `:`+pad(msg.PS.Status.Game.DCS.RunTime.Hours,2)+`:`+pad(msg.PS.Status.Game.DCS.RunTime.Minutes,2)+`:`+pad(msg.PS.Status.Game.DCS.RunTime.Seconds,2)+`\n      Process Priority : `+GetPriority(msg.PS.Status.Game.DCS.PriorityClass)+`\n           Server Port : `+msg.PS.Details.Config.DCS.Port+`\n              Password : `+msg.PS.Details.Config.DCS.Passwrd+`\n           Max Players : `+msg.PS.Details.Config.DCS.MaxPlayers+`\n      Max Ping Allowed : `+msg.PS.Details.Config.DCS.MaxPing+`ms\n\n          ##### LotATC   INFO ####\n        LotATC Version : `+msg.PS.Details.Config.LotATC.Version+`\n           LotATC Port : `+msg.PS.Details.Config.LotATC.Port+`\n              Blue Pwd : `+msg.PS.Details.Config.LotATC.BluPWD+`\n               Red Pwd : `+msg.PS.Details.Config.LotATC.RedPWD+`\n\n          #### TACview   INFO ####\n               Version : `+msg.PS.Details.Config.Tacview.Version+`\n          TACview Port : `+msg.PS.Details.Config.Tacview.Port+`\n                 Delay : `+msg.PS.Details.Config.Tacview.Delay+`\n            Client Pwd : `+msg.PS.Details.Config.Tacview.ClientPWD\n        }\n    else {\n        dcs = `\n              #### DCS   INFO ####\n     DCS Server Status : `+dcsok+`\n    InGame Server Name : `+msg.PS.Details.Config.DCS.ServerName+`\n               Version : `+msg.PS.Details.Config.DCS.Version+`\n           Server Port : `+msg.PS.Details.Config.DCS.Port+`\n              Password : `+msg.PS.Details.Config.DCS.Passwrd+`\n           Max Players : `+msg.PS.Details.Config.DCS.MaxPlayers+`\n      Max Ping Allowed : `+msg.PS.Details.Config.DCS.MaxPing+`ms\n    \n           #### LotATC   INFO ####\n               Version : `+msg.PS.Details.Config.LotATC.Version+`\n           LotATC Port : `+msg.PS.Details.Config.LotATC.Port+`\n              Blue Pwd : `+msg.PS.Details.Config.LotATC.BluPWD+`\n               Red Pwd : `+msg.PS.Details.Config.LotATC.RedPWD+`\n    \n          #### TACview   INFO ####\n       TACview Version : `+msg.PS.Details.Config.Tacview.Version+`\n          TACview Port : `+msg.PS.Details.Config.Tacview.Port+`\n                 Delay : `+msg.PS.Details.Config.Tacview.Delay+`\n            Client Pwd : `+msg.PS.Details.Config.Tacview.ClientPWD\n        }\n////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////        \n//SRS            \nvar srsok = \"OFFLINE\";\nvar srs = \"\";\n    if(msg.PS.Status.Game.SRS.IsActive) {\n\t\tif(msg.PS.Status.Game.SRS.Responding) {srsok = `OK`} else {srsok = `NOT RESPONDING`}\n        srs = `\n              #### SRS   INFO ####\n                Status : `+srsok+`\n               Version : `+msg.PS.Details.Config.SRS.Version+`\n            SRS UpTime : `+pad(msg.PS.Status.Game.SRS.RunTime.Days,2)+ `:`+pad(msg.PS.Status.Game.SRS.RunTime.Hours,2)+`:`+pad(msg.PS.Status.Game.SRS.RunTime.Minutes,2)+`:`+pad(msg.PS.Status.Game.SRS.RunTime.Seconds,2)+`\n      Process Priority : `+GetPriority(msg.PS.Status.Game.SRS.PriorityClass)+`\n           Server Port : `+msg.PS.Details.Config.SRS.Port+`\n              Blue Pwd : `+msg.PS.Details.Config.SRS.BluPWD+`\n               Red Pwd : `+msg.PS.Details.Config.SRS.RedPWD\n        }\n    else {\n        srs = `\n              #### SRS   INFO ####\n                Status : `+srsok+`\n               Version : `+msg.PS.Details.Config.SRS.Version+`\n           Server Port : `+msg.PS.Details.Config.SRS.Port+`\n              Blue Pwd : `+msg.PS.Details.Config.SRS.BluPWD+`\n               Red Pwd : `+msg.PS.Details.Config.SRS.RedPWD\n        }\n\nvar transmit = `Requested by `+responsee+` \\`\\`\\` DETAILED REPORT for ` +DDC2.ServerID+ ` as at ` +localdatetime+`\n `+serverMSG+` \n `+dcs+`\n `+srs+`\n `+dcsUpdate+`\n `+srsUpdate+`\n `+lotUpdate+`\n  \\`\\`\\`*Request completed in `+ttc+`*` \n//LOG/SECTION//////////////////////////////////////////////////////////////////////////\nvar access = \"DENIED\";\nif (msg.message.authorized) {access = \"GRANTED\"}\nvar logmsg = ` \\`\\`\\`    TimeStamp: ` +localdatetime+ `\n     RequestID: `+msg._msgid+`\n     Requestor: `+usrname+ `\n  Request Type: ` +msg.message.request+ `\n       Raw Msg: `+msg.message.raw+`\n     Responder: ` +DDC2.ServerID+ `\n        Access: ` +access+ `\n      Comments: Request completed in `+ttc+`\\`\\`\\` `\nvar logsend = {\"payload\": logmsg};\n//TRANSMIT/SECTION/////////////////////////////////////////////////////////////////////\nmsg.payload = transmit\n\nnode.status({fill:\"green\",shape:\"ring\",text: \"Reports Sent: \"+MsgSent});\ncontext.set('MsgSent', (MsgSent + 1));\n\nreturn [[msg],[logsend]];\n}","outputs":2,"noerr":0,"initialize":"","finalize":"","x":1410,"y":540,"wires":[["8b7ff56e.ec7a38"],["3ac775da.46ecca"]],"inputLabels":["Powershell Output"],"outputLabels":["Server-Status","Server-Log"],"icon":"node-red/envelope.svg"},{"id":"a04d74da.e28ce8","type":"json","z":"437000c7.c01d","name":"","property":"payload","action":"","pretty":false,"x":750,"y":660,"wires":[["495bccda.dbc334"]]},{"id":"495bccda.dbc334","type":"change","z":"437000c7.c01d","name":"MovePS Output","rules":[{"t":"move","p":"payload","pt":"msg","to":"PS","tot":"msg"}],"action":"","property":"","from":"","to":"","reg":false,"x":880,"y":700,"wires":[["103b3017.99df3"]]},{"id":"a6acb7fc.fef918","type":"delay","z":"437000c7.c01d","name":"Delay x","pauseType":"delayv","timeout":"60","timeoutUnits":"seconds","rate":"1","nbRateUnits":"1","rateUnits":"second","randomFirst":"1","randomLast":"5","randomUnits":"seconds","drop":false,"x":260,"y":660,"wires":[["9c4c4ff.f7d2ab"]]},{"id":"a09d8fb8.b973e","type":"rbe","z":"437000c7.c01d","name":"","func":"rbe","gap":"","start":"","inout":"out","property":"payload","x":1450,"y":600,"wires":[["8b7ff56e.ec7a38"]]},{"id":"e6c50dc2.01a85","type":"function","z":"437000c7.c01d","name":"!access MSG","func":"var MsgSent = context.get('MsgSent') || 1;\nvar DDC2 = flow.get('DDC2');\nvar usrname = msg.author.username;\nvar responsee = \"<@\"+msg.author.id+\">\";\nvar tmstmp = msg.data.createdTimestamp;\nvar localdatetime = (new Date(tmstmp)).toLocaleString();\nvar msgLOG = msg;\nvar StatusMSG = {\"payload\" : ``};\n//var LogMSG = {\"payload\" : ``};\n//FUNCTIONS////////////////////////////////////////////////////////////////////////////\nfunction pad(num, size) {\n    var s = num+\"\";\n    while (s.length < size) s = \"0\" + s;\n    return s;\n}\nDate.daysBetween = function( date1, date2 ) {\n  var one_day=1000*60*60*24;\n  var date1_ms = date1.getTime();\n  var date2_ms = date2.getTime();\n  var difference_ms = date2_ms - date1_ms;\n  difference_ms = Math.round(difference_ms/1000,3);\n  var mseconds = difference_ms % 1000;\n  var seconds = Math.floor(difference_ms % 60);\n  difference_ms = difference_ms/60; \n  var minutes = Math.floor(difference_ms % 60);\n  difference_ms = difference_ms/60; \n  var hours = Math.floor(difference_ms % 24);  \n  var days = Math.floor(difference_ms/24);\n  return pad(minutes,2) + ':' + pad(seconds,2) + '.' + pad(mseconds,3);\n}\n//END//FUNCTIONS///////////////////////////////////////////////////////////////////////\nif((msg.message.request == \"!access\") || (msg.message.request == \"!secure\")) {\n    var ttc = Date.daysBetween((new Date(tmstmp)), new Date());\n    if(msg.message.request == \"!access\") { //Finalizing Initial Run through: Message 1\n        flow.set('DDC2.Connected', false)\n        if(msg.PS.ValidIP === true) { //Access Granted\n            msg.message.request = \"!secure\";\n            msg.message.payload = `-secure -IP `+msg.message.IP+` -USER `+msg.message.User+` -ID `+msg.message.DiscordID; //Shows the next message to be sent to the script\n            msg.payload = msg.message.payload; //Loop MSG\n            msg.message.commentLog = 'Firewall rule created for '+msg.message.User+`(DiscordID: `+msg.message.DiscordID+`)`\n///////////////////////////////////////////////////////////////////////////////////////\n            RDPpayload = ` \\`\\`\\``+DDC2.ServerID+ ` has granted access to `+msg.message.User+`, door's open, come on in...\n\nRDP Connection information: `+DDC2.Info.PS.Details.Info.IPAddr+`:`+DDC2.Info.PS.Details.Info.RDPport+`\n        \nRequest completed in `+ttc+`\\`\\`\\` `\n\nVNCpayload = ` \\`\\`\\``+DDC2.ServerID+ ` has granted access to `+msg.message.User+`, door's open, come on in...\n\n`+DDC2.VNC.Type+` Connection information: `+DDC2.Info.PS.Details.Info.IPAddr+`:`+DDC2.VNC.Port+`\n        \nRequest completed in `+ttc+`\\`\\`\\` `\n///////////////////////////////////////////////////////////////////////////////////////\n            if (DDC2.VNC.Enabled) {StatusMSG.payload = VNCpayload} else {StatusMSG.payload = RDPpayload} //Status MSG\n            node.status({fill:\"green\",shape:\"ring\",text: \"Status Sent: \"+MsgSent});\n            context.set('MsgSent', (MsgSent + 1));\n            return [StatusMSG,msg,msg];\n            }\n        else { //Access Denied (Invalid IP) End Loop\n            msg.message.commentLog = `Invalid IPv4 Address (`+msg.PS.IP+`) supplied, no Firewall rule was created for `+msg.message.User\n///////////////////////////////////////////////////////////////////////////////////////\n            payload = ` \\`\\`\\``+DDC2.ServerID+ ` received an invalid request (`+msg.message.request+`) request. (IP `+msg.PS.IP+` is not a valid IPv4 Address)\n\nNOTE: Please use the following syntax: !access `+DDC2.ServerID+` <IPv4Address>\n\nRequest completed in `+ttc+`\\`\\`\\` `\n///////////////////////////////////////////////////////////////////////////////////////\n            StatusMSG.payload = payload; //Status MSG\n            node.status({fill:\"green\",shape:\"ring\",text: \"Status Sent: \"+MsgSent});\n            context.set('MsgSent', (MsgSent + 1));\n            return [StatusMSG,msg,null]; //Don't send back to loop\n            }\n        }\n    if(msg.message.request == \"!secure\") { //Message 2 / 3\n        if(msg.PS.Connected === true) {\n            flow.set('DDC2.Connected', true)\n            msg.message.request = \"!secure\";\n            msg.message.payload = `-secure -IP `+msg.message.IP+` -USER `+msg.message.User+` -ID `+msg.message.DiscordID; //Shows the next message to be sent to the script\n            msg.payload = msg.message.payload; //Loop MSG\n            msg.message.commentLog = msg.message.User+` has connected to `+DDC2.ServerID\n///////////////////////////////////////////////////////////////////////////////////////\n            payload = ` \\`\\`\\``+msg.message.User+ ` has successfully connected to `+DDC2.ServerID+`\\`\\`\\` `\n///////////////////////////////////////////////////////////////////////////////////////\n            StatusMSG.payload = payload; //Status MSG\n            node.status({fill:\"green\",shape:\"ring\",text: \"Status Sent: \"+MsgSent});\n            context.set('MsgSent', (MsgSent + 1));\n            return [StatusMSG,msg,msg];\n            }\n        if(msg.PS.Connected === false) {\n            if(DDC2.Connected === true) { //User was connected but now is not\n                flow.set('DDC2.Connected', false)\n///////////////////////////////////////////////////////////////////////////////////////\n                payload = ` \\`\\`\\``+msg.message.User+ `, it was good to see you. Thanks for stopping by for approximately `+ttc+`. \n`+DDC2.ServerID+` has locked the door....\\`\\`\\` `\n///////////////////////////////////////////////////////////////////////////////////////\n                StatusMSG.payload = payload; //Status MSG\n                msg.message.commentLog = msg.message.User+` has disconnected from `+DDC2.ServerID+`, they were connected for approximately `+ttc\n                node.status({fill:\"green\",shape:\"ring\",text: \"Status Sent: \"+MsgSent});\n                context.set('MsgSent', (MsgSent + 1));\n                return [StatusMSG,msg,null];\n                }\n            else { //User never connected\n                flow.set('DDC2.Connected', false)\n///////////////////////////////////////////////////////////////////////////////////////\n                payload = ` \\`\\`\\``+msg.message.User+ ` obviously had something better to do, no connection was established. \n`+DDC2.ServerID+` has locked the door....\\`\\`\\` `\n///////////////////////////////////////////////////////////////////////////////////////\n                StatusMSG.payload = payload; //Status MSG\n                msg.message.commentLog = msg.message.User+` never connected to `+DDC2.ServerID\n                node.status({fill:\"green\",shape:\"ring\",text: \"Status Sent: \"+MsgSent});\n                context.set('MsgSent', (MsgSent + 1));\n                return [StatusMSG,msg,null];\n                }\n            }\n        }\n    }","outputs":3,"noerr":0,"initialize":"","finalize":"","x":1290,"y":640,"wires":[["a09d8fb8.b973e"],["a230e5c9.2e5858"],["57793227.c277bc"]],"inputLabels":["Powershell Output"],"outputLabels":["Server-Status","Server-Log","Loop"],"icon":"node-red/envelope.svg"},{"id":"a230e5c9.2e5858","type":"rbe","z":"437000c7.c01d","name":"","func":"rbe","gap":"","start":"","inout":"out","property":"message.commentLog","x":1451,"y":640,"wires":[["20dc435a.cec5ac"]]},{"id":"57793227.c277bc","type":"link out","z":"437000c7.c01d","name":"AccessLoopv2","links":["cc0e2072.c30c3"],"x":1415,"y":680,"wires":[]},{"id":"cc0e2072.c30c3","type":"link in","z":"437000c7.c01d","name":"AccessLoopv2","links":["57793227.c277bc"],"x":155,"y":660,"wires":[["a6acb7fc.fef918"]]},{"id":"7d9019ce.50fc08","type":"inject","z":"437000c7.c01d","name":"AutoStart","repeat":"","crontab":"","once":true,"onceDelay":"1","topic":"","payload":"true","payloadType":"bool","x":120,"y":780,"wires":[[]]},{"id":"e631b2af.7975d","type":"delay","z":"437000c7.c01d","name":"","pauseType":"delay","timeout":"1","timeoutUnits":"seconds","rate":"1","nbRateUnits":"1","rateUnits":"second","randomFirst":"1","randomLast":"5","randomUnits":"seconds","drop":false,"x":260,"y":740,"wires":[["613c27f5.da46c8"]]},{"id":"613c27f5.da46c8","type":"function","z":"437000c7.c01d","name":"Task Start MSG","func":"//This Node unpacks the msg and does a check that this server is the checks that the server that has been requested is this server\nvar payload = \"-update\"; //Changed while testing (Switch between -report or -update)\nmsg.payload = payload;\nvar DDC2 = flow.get('DDC2');\nvar permArr = flow.get('DDC2.Permissions.reboot');\n\nmsg.member = {\n    \"_roles\" : permArr\n    }\nmsg.author = {\n        \"username\": DDC2.ServerID,\n        \"id\": DDC2.ServerID\n    }\nmsg.message = {\n    \"request\": \"!autostart\",\n    \"raw\" : \"!autostart\",\n    \"valid\": true,\n    \"authorized\" : true\n    }\nmsg.data = {\n    \"createdTimestamp\": Date.now()\n    }\nmsg.channel = {\n    \"id\": DDC2.Channel.Admin\n    }\nreturn msg;","outputs":1,"noerr":0,"initialize":"","finalize":"","x":420,"y":780,"wires":[["56987732.756ed8","9c4c4ff.f7d2ab","20dc435a.cec5ac"]],"inputLabels":["Post-Whitelist-Check"],"outputLabels":["Standard Out"]},{"id":"5d7831b5.8e56b","type":"discordMessage","z":"437000c7.c01d","name":"Get Message","token":"","x":170,"y":860,"wires":[["8588ef16.4c8cc"]]},{"id":"8b7ff56e.ec7a38","type":"discordSendMessage","z":"437000c7.c01d","name":"Admin Channel","channel":"567983599408775168","token":"","x":1640,"y":600,"wires":[]},{"id":"3ac775da.46ecca","type":"discordSendMessage","z":"437000c7.c01d","name":"Server Log","channel":"717443103690326108","token":"","x":1630,"y":540,"wires":[]},{"id":"e7b508ac.33ec88","type":"function","z":"437000c7.c01d","name":"Set DDC2.Info","func":"flow.set('DDC2.Info.Bool', false);\nnode.status({fill:\"green\",shape:\"dot\",text:\"DDC2.Info.Bool: SET\"});","outputs":0,"noerr":0,"initialize":"","finalize":"","x":920,"y":60,"wires":[],"icon":"node-red/alert.svg"},{"id":"774b8554.fbe1bc","type":"function","z":"437000c7.c01d","name":"!info Blue","func":"var MsgSent = context.get('MsgSent') || 1;\nvar DDC2 = flow.get('DDC2');\nvar usrname = msg.author.username; \nvar responsee = (msg.author.id === DDC2.ServerID) ? msg.author.id : \"<@\"+msg.author.id+\">\" \n//FUNCTIONS////////////////////////////////////////////////////////////////////////////\nfunction pad(num, size) {\n    var s = num+\"\";\n    while (s.length < size) s = \"0\" + s;\n    return s;\n}\nDate.daysBetween = function( date1, date2 ) {\n  var one_day=1000*60*60*24;\n  var date1_ms = date1.getTime();\n  var date2_ms = date2.getTime();\n  var difference_ms = date2_ms - date1_ms;\n  difference_ms = Math.round(difference_ms/1000,3);\n  var mseconds = difference_ms % 1000;\n  var seconds = Math.floor(difference_ms % 60);\n  difference_ms = difference_ms/60; \n  var minutes = Math.floor(difference_ms % 60);\n  difference_ms = difference_ms/60; \n  var hours = Math.floor(difference_ms % 24);  \n  var days = Math.floor(difference_ms/24);\n  return pad(minutes,2) + ':' + pad(seconds,2) + '.' + pad(mseconds,3);\n}\nfunction GetPriority(priority) {\nvar PriorityTable = { 64:\"Low\", \n                   16384:\"Below Normal\", \n                      32:\"Normal\", \n                   32768:\"Above Normal\", \n                     128:\"High\",\n\t\t\t\t\t 256:\"Realtime\"\n\t\t\t\t\t};\nreturn (PriorityTable[priority])\n}\n//END//FUNCTIONS///////////////////////////////////////////////////////////////////////\nif(msg.channel.id == DDC2.Channel.Blue) {\nvar request = msg.message.request; \nif(request == \"!info\") {\nvar localdatetime = (new Date(msg.data.createdTimestamp)).toLocaleString();\nvar InfoOK = DDC2.Info.Bool;\nvar serverMSG = ``;\nif(InfoOK) {\n    var tmstmp = DDC2.Info.TimeStamp\n    var ttc = Date.daysBetween((new Date(msg.data.createdTimestamp)), new Date());\n    var reportage = Date.daysBetween((new Date(tmstmp)), new Date());\n    var reportdatetime = (new Date(tmstmp)).toLocaleString();\n    var PS = flow.get('DDC2.Info.PS');\n////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////\n////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////        \n//GAME PROCESSES////////////////////////////////////////////////////////////////////////////////////////////////////////\n////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////\n//DCS\nvar dcsok = \"OFFLINE\";\nvar dcs = \"\";\n    if(PS.Status.Game.DCS.IsActive) {if(PS.Status.Game.DCS.Responding) {dcsok = `OK`} else {dcsok = `NOT RESPONDING`}}\n        dcs = `\n              #### DCS   INFO ####\n     DCS Server Status : `+dcsok+`\n    InGame Server Name : `+PS.Details.Config.DCS.ServerName+`\n               Version : `+PS.Details.Config.DCS.Version+`\n           Server Port : `+PS.Details.Config.DCS.Port+`\n              Password : `+PS.Details.Config.DCS.Passwrd+`\n      Max Ping Allowed : `+PS.Details.Config.DCS.MaxPing+`ms\n\n          ##### LotATC   INFO ####\n        LotATC Version : `+PS.Details.Config.LotATC.Version+`\n           LotATC Port : `+PS.Details.Config.LotATC.Port+`\n              Blue Pwd : `+PS.Details.Config.LotATC.BluPWD+`\n               Red Pwd : <##REDACTED##>\n\n          #### TACview   INFO ####\n               Version : `+PS.Details.Config.Tacview.Version+`\n          TACview Port : `+PS.Details.Config.DCS.Port+`\n                 Delay : <##REDACTED##>\n            Client Pwd : <##REDACTED##>`\n////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////        \n//SRS            \nvar srsok = \"OFFLINE\";\nvar srs = \"\";\n    if(PS.Status.Game.SRS.IsActive) {if(PS.Status.Game.SRS.Responding) {srsok = `OK`} else {srsok = `NOT RESPONDING`}}\n        srs = `\n              #### SRS   INFO ####\n                Status : `+srsok+`\n               Version : `+PS.Details.Config.SRS.Version+`\n           Server Port : `+PS.Details.Config.SRS.Port+`\n              Blue Pwd : `+PS.Details.Config.SRS.BluPWD+`\n               Red Pwd : <##REDACTED##>`\n\n    serverMSG = `\n           #### SERVER   INFO ####\n             DDC2 Name : `+DDC2.ServerID+`\n       Server DownTime : `+DDC2.ServerDT+`\n             Server IP : `+PS.Details.Info.IPAddr+`\n      Last Report Done : `+reportdatetime+`\n              Data Age : `+reportage\n    }\nelse {\n    serverMSG = `No variables currently set, please run a !report to populate flow variables`\n    }\n\nvar transmit = `Requested by `+responsee+` \\`\\`\\`BLUE FORCE CAHCED INFO REPORT for ` +DDC2.ServerID+ ` as at ` +localdatetime+`\n `+serverMSG+` \n `+dcs+`\n `+srs+`\n \\`\\`\\`*Request completed in `+ttc+`*` \n//LOG/SECTION//////////////////////////////////////////////////////////////////////////\nvar access = \"DENIED\";\nif (msg.message.authorized) {access = \"GRANTED\"}\nvar LogChan = {\n    \"id\": DDC2.Channel.Log\n    }\nvar logmsg = ` \\`\\`\\`    TimeStamp: ` +localdatetime+ `\n     RequestID: `+msg._msgid+`\n     Requestor: `+usrname+ `\n  Request Type: ` +msg.message.request+ `\n       Raw Msg: `+msg.message.raw+`\n     Responder: ` +DDC2.ServerID+ `\n        Access: ` +access+ `\n      Comments: Blue Force - Request completed in `+ttc+`\\`\\`\\` `\nvar logsend = {\n    \"payload\": logmsg,\n    \"channel\": LogChan\n    };\n//TRANSMIT/SECTION/////////////////////////////////////////////////////////////////////\nmsg.payload = transmit\n\nnode.status({fill:\"green\",shape:\"ring\",text: \"Reports Sent: \"+MsgSent});\ncontext.set('MsgSent', (MsgSent + 1));\n\nreturn [[msg],[logsend]];\n    }\n}","outputs":2,"noerr":0,"initialize":"","finalize":"","x":1320,"y":1020,"wires":[["26937249.88bcee"],["26937249.88bcee"]],"inputLabels":["Powershell Output"],"outputLabels":["Server-Status","Server-Log"],"icon":"node-red/envelope.svg"},{"id":"67df55ee.db418c","type":"function","z":"437000c7.c01d","name":"!info Red","func":"var MsgSent = context.get('MsgSent') || 1;\nvar DDC2 = flow.get('DDC2');\nvar usrname = msg.author.username; \nvar responsee = (msg.author.id === DDC2.ServerID) ? msg.author.id : \"<@\"+msg.author.id+\">\" \n//FUNCTIONS////////////////////////////////////////////////////////////////////////////\nfunction pad(num, size) {\n    var s = num+\"\";\n    while (s.length < size) s = \"0\" + s;\n    return s;\n}\nDate.daysBetween = function( date1, date2 ) {\n  var one_day=1000*60*60*24;\n  var date1_ms = date1.getTime();\n  var date2_ms = date2.getTime();\n  var difference_ms = date2_ms - date1_ms;\n  difference_ms = Math.round(difference_ms/1000,3);\n  var mseconds = difference_ms % 1000;\n  var seconds = Math.floor(difference_ms % 60);\n  difference_ms = difference_ms/60; \n  var minutes = Math.floor(difference_ms % 60);\n  difference_ms = difference_ms/60; \n  var hours = Math.floor(difference_ms % 24);  \n  var days = Math.floor(difference_ms/24);\n  return pad(minutes,2) + ':' + pad(seconds,2) + '.' + pad(mseconds,3);\n}\nfunction GetPriority(priority) {\nvar PriorityTable = { 64:\"Low\", \n                   16384:\"Below Normal\", \n                      32:\"Normal\", \n                   32768:\"Above Normal\", \n                     128:\"High\",\n\t\t\t\t\t 256:\"Realtime\"\n\t\t\t\t\t};\nreturn (PriorityTable[priority])\n}\n//END//FUNCTIONS///////////////////////////////////////////////////////////////////////\nif(msg.channel.id == DDC2.Channel.Red) {\nvar request = msg.message.request; \nif(request == \"!info\") {\nvar localdatetime = (new Date(msg.data.createdTimestamp)).toLocaleString();\nvar InfoOK = DDC2.Info.Bool;\nvar serverMSG = ``;\nif(InfoOK) {\n    var tmstmp = DDC2.Info.TimeStamp\n    var ttc = Date.daysBetween((new Date(msg.data.createdTimestamp)), new Date());\n    var reportage = Date.daysBetween((new Date(tmstmp)), new Date());\n    var reportdatetime = (new Date(tmstmp)).toLocaleString();\n    var PS = flow.get('DDC2.Info.PS');\n////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////\n////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////        \n//GAME PROCESSES////////////////////////////////////////////////////////////////////////////////////////////////////////\n////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////\n//DCS\nvar dcsok = \"OFFLINE\";\nvar dcs = \"\";\n    if(PS.Status.Game.DCS.IsActive) {if(PS.Status.Game.DCS.Responding) {dcsok = `OK`} else {dcsok = `NOT RESPONDING`}}\n        dcs = `\n              #### DCS   INFO ####\n     DCS Server Status : `+dcsok+`\n    InGame Server Name : `+PS.Details.Config.DCS.ServerName+`\n               Version : `+PS.Details.Config.DCS.Version+`\n           Server Port : `+PS.Details.Config.DCS.Port+`\n              Password : `+PS.Details.Config.DCS.Passwrd+`\n      Max Ping Allowed : `+PS.Details.Config.DCS.MaxPing+`ms\n\n          ##### LotATC   INFO ####\n        LotATC Version : `+PS.Details.Config.LotATC.Version+`\n           LotATC Port : `+PS.Details.Config.LotATC.Port+`\n              Blue Pwd : <##REDACTED##>\n               Red Pwd : `+PS.Details.Config.LotATC.RedPWD+`\n\n          #### TACview   INFO ####\n               Version : `+PS.Details.Config.Tacview.Version+`\n          TACview Port : `+PS.Details.Config.DCS.Port+`\n                 Delay : <##REDACTED##>\n            Client Pwd : <##REDACTED##>`\n////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////        \n//SRS            \nvar srsok = \"OFFLINE\";\nvar srs = \"\";\n    if(PS.Status.Game.SRS.IsActive) {if(PS.Status.Game.SRS.Responding) {srsok = `OK`} else {srsok = `NOT RESPONDING`}}\n        srs = `\n              #### SRS   INFO ####\n                Status : `+srsok+`\n               Version : `+PS.Details.Config.SRS.Version+`\n           Server Port : `+PS.Details.Config.SRS.Port+`\n              Blue Pwd : <##REDACTED##>\n               Red Pwd : `+PS.Details.Config.SRS.RedPWD\n\n    serverMSG = `\n           #### SERVER   INFO ####\n             DDC2 Name : `+DDC2.ServerID+`\n       Server DownTime : `+DDC2.ServerDT+`\n             Server IP : `+PS.Details.Info.IPAddr+`\n      Last Report Done : `+reportdatetime+`\n              Data Age : `+reportage\n    }\nelse {\n    serverMSG = `No variables currently set, please run a !report to populate flow variables`\n    }\n\nvar transmit = `Requested by `+responsee+` \\`\\`\\`RED FORCE CAHCED INFO REPORT for ` +DDC2.ServerID+ ` as at ` +localdatetime+`\n `+serverMSG+` \n `+dcs+`\n `+srs+`\n \\`\\`\\`*Request completed in `+ttc+`*` \n//LOG/SECTION//////////////////////////////////////////////////////////////////////////\nvar access = \"DENIED\";\nif (msg.message.authorized) {access = \"GRANTED\"}\nvar LogChan = {\n    \"id\": DDC2.Channel.Log\n    }\nvar logmsg = ` \\`\\`\\`    TimeStamp: ` +localdatetime+ `\n     RequestID: `+msg._msgid+`\n     Requestor: `+usrname+ `\n  Request Type: ` +msg.message.request+ `\n       Raw Msg: `+msg.message.raw+`\n     Responder: ` +DDC2.ServerID+ `\n        Access: ` +access+ `\n      Comments: Red Force - Request completed in `+ttc+`\\`\\`\\` `\nvar logsend = {\n    \"payload\": logmsg,\n    \"channel\": LogChan\n    };\n//TRANSMIT/SECTION/////////////////////////////////////////////////////////////////////\nmsg.payload = transmit\n\nnode.status({fill:\"green\",shape:\"ring\",text: \"Reports Sent: \"+MsgSent});\ncontext.set('MsgSent', (MsgSent + 1));\n\nreturn [[msg],[logsend]];\n    }\n}","outputs":2,"noerr":0,"initialize":"","finalize":"","x":1320,"y":1080,"wires":[["26937249.88bcee"],["26937249.88bcee"]],"inputLabels":["Powershell Output"],"outputLabels":["Server-Status","Server-Log"],"icon":"node-red/envelope.svg"},{"id":"651b8eeb.b9907","type":"function","z":"437000c7.c01d","name":"Set DDC2.Channels","func":"var AdminChannel = \"567983599408775168\"; //For Admin Messages ONLY\nvar BlueChannel = \"732722455461888110\"; //For Blue Force Messages ONLY\nvar RedChannel = \"732722414424817706\"; //For Red Force Messages ONLY\nvar LogChannel = \"717443103690326108\"; //For Log Messages ONLY\n//Setting Variables for Channels\nflow.set('DDC2.Channel.Admin', AdminChannel);\nflow.set('DDC2.Channel.Blue', BlueChannel);\nflow.set('DDC2.Channel.Red', RedChannel);\nflow.set('DDC2.Channel.Log', LogChannel);\n\nnode.status({fill:\"green\",shape:\"dot\",text:\"DDC2.Channels: SET\"});","outputs":0,"noerr":0,"initialize":"","finalize":"","x":640,"y":360,"wires":[],"icon":"node-red/cog.svg"},{"id":"26937249.88bcee","type":"discordSendMessage","z":"437000c7.c01d","name":"Response Channel","channel":"","token":"","x":1570,"y":900,"wires":[]},{"id":"57b168e.e21ca98","type":"function","z":"437000c7.c01d","name":"!status MSG","func":"var MsgSent = context.get('MsgSent') || 1;\nvar DDC2 = flow.get('DDC2');\nvar usrname = msg.author.username; \nvar responsee = (msg.author.id === DDC2.ServerID) ? msg.author.id : \"<@\"+msg.author.id+\">\" \n//var responsee = if (msg.author.id != DCSCNC.ServerID) {\"<@\"+msg.author.id+\">\"} else {msg.author.id};\n//var responsee = \"<@\"+msg.author.id+\">\"; \nvar request = msg.message.request; \n\nvar tmstmp = msg.data.createdTimestamp;\nvar localdatetime = (new Date(tmstmp)).toLocaleString();\n\n//FUNCTIONS////////////////////////////////////////////////////////////////////////////\nfunction pad(num, size) {\n    var s = num+\"\";\n    while (s.length < size) s = \"0\" + s;\n    return s;\n}\nDate.daysBetween = function( date1, date2 ) {\n  var one_day=1000*60*60*24;\n  var date1_ms = date1.getTime();\n  var date2_ms = date2.getTime();\n  var difference_ms = date2_ms - date1_ms;\n  difference_ms = Math.round(difference_ms/1000,3);\n  var mseconds = difference_ms % 1000;\n  var seconds = Math.floor(difference_ms % 60);\n  difference_ms = difference_ms/60; \n  var minutes = Math.floor(difference_ms % 60);\n  difference_ms = difference_ms/60; \n  var hours = Math.floor(difference_ms % 24);  \n  var days = Math.floor(difference_ms/24);\n  return pad(minutes,2) + ':' + pad(seconds,2) + '.' + pad(mseconds,3);\n}\nfunction GetPriority(priority) {\nvar PriorityTable = { 64:\"Low\", \n                   16384:\"Below Normal\", \n                      32:\"Normal\", \n                   32768:\"Above Normal\", \n                     128:\"High\",\n\t\t\t\t\t 256:\"Realtime\"\n\t\t\t\t\t};\nreturn (PriorityTable[priority])\n}\n//END//FUNCTIONS///////////////////////////////////////////////////////////////////////\nif((msg.message.request == \"!status\") || (msg.message.request == \"!stop\") || (request == \"!update\") || (request == \"!autostart\")) {\nflow.set('DDC2.Info.PS.Details.Info',msg.PS.Details.Info);\nflow.set('DDC2.Info.PS.Status',msg.PS.Status);\nflow.set('DDC2.Info.Bool',true);\nflow.set('DDC2.Info.TimeStamp',tmstmp);\nvar ttc = Date.daysBetween((new Date(tmstmp)), new Date());\n//SERVER DETAILS\nvar serverMSG = `\n           #### SERVER   INFO ####\n             DDC2 Name : `+DDC2.ServerID+`\n         Server UpTime : `+pad(msg.PS.Details.Info.UpTime.Days,2)+ `:`+pad(msg.PS.Details.Info.UpTime.Hours,2)+`:`+pad(msg.PS.Details.Info.UpTime.Minutes,2)+`:`+pad(msg.PS.Details.Info.UpTime.Seconds,2)+`\n           Memory Load : `+msg.PS.Details.Info.MEMLoad+` %\n              CPU Load : `+msg.PS.Details.Info.CPULoad+` %`\n////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////\n//UPDATERS//////////////////////////////////////////////////////////////////////////////////////////////////////////////\n////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////\n//DCS Updater\nvar dcsUpdateok = \"INACTIVE\";\nvar dcsUpdate = \"\";\n    if(msg.PS.Status.Update.DCS_updater.IsActive) {\n\t\tif(msg.PS.Status.Update.DCS_updater.Responding) {dcsUpdateok = `RUNNING`} else {dcsUpdateok = `NOT RESPONDING`}\n    dcsUpdate = `\n           #### UPDATE   INFO ####\n     DCS Update Status : `+dcsUpdateok+`\n      DCS Update Ticks : `+msg.PS.Status.Update.DCS_updater.Ticks+`\n       DCS Update Time : `+pad(msg.PS.Status.Update.DCS_updater.RunTime.Days,2)+ `:`+pad(msg.PS.Status.Update.DCS_updater.RunTime.Hours,2)+`:`+pad(msg.PS.Status.Update.DCS_updater.RunTime.Minutes,2)+`:`+pad(msg.PS.Status.Update.DCS_updater.RunTime.Seconds,2)\n        }\n    else {\n      dcsUpdate = `\n           #### UPDATE   INFO ####\n     DCS Update Status : `+dcsUpdateok+`\n      DCS Update Ticks : -\n       DCS Update Time : -`\n        }\n////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////\n//SRS Updater\nvar srsUpdateok = \"INACTIVE\";\nvar srsUpdate = \"\";\n    if(msg.PS.Status.Update.SRS_Updater.IsActive) {\n\t\tif(msg.PS.Status.Update.SRS_updater.Responding) {srsUpdateok = `RUNNING`} else {srsUpdateok = `NOT RESPONDING`}\n    srsUpdate = `\n     SRS Update Status : `+srsUpdateok+`\n      SRS Update Ticks : `+msg.PS.Status.Update.SRS_updater.Ticks+`\n       SRS Update Time : `+pad(msg.PS.Status.Update.SRS_updater.RunTime.Days,2)+ `:`+pad(msg.PS.Status.Update.SRS_updater.RunTime.Hours,2)+`:`+pad(msg.PS.Status.Update.SRS_updater.RunTime.Minutes,2)+`:`+pad(msg.PS.Status.Update.SRS_updater.RunTime.Seconds,2)\n        }\n    else {\n      srsUpdate = `\n     SRS Update Status : `+srsUpdateok+`\n      SRS Update Ticks : -\n       SRS Update Time : -`\n        }\n////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////\n//LotATC Updater\nvar lotUpdateok = \"INACTIVE\";\nvar lotUpdate = \"\";\n    if(msg.PS.Status.Update.LOT_Updater.IsActive) {\n\t\tif(msg.PS.Status.Update.LOT_updater.Responding) {lotUpdateok = `RUNNING`} else {lotUpdateok = `NOT RESPONDING`}\n    lotUpdate = `\n  LotATC Update Status : `+lotUpdateok+`\n   LotATC Update Ticks : `+msg.PS.Status.Update.LOT_updater.Ticks+`\n    LotATC Update Time : `+pad(msg.PS.Status.Update.LOT_updater.RunTime.Days,2)+ `:`+pad(msg.PS.Status.Update.LOT_updater.RunTime.Hours,2)+`:`+pad(msg.PS.Status.Update.LOT_updater.RunTime.Minutes,2)+`:`+pad(msg.PS.Status.Update.LOT_updater.RunTime.Seconds,2)\n        }\n    else {\n      lotUpdate = `\n  LotATC Update Status : `+lotUpdateok+`\n   LotATC Update Ticks : -\n    LotATC Update Time : -`\n        }\n////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////\n////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////        \n//GAME PROCESSES////////////////////////////////////////////////////////////////////////////////////////////////////////\n////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////\n//DCS\nvar dcsok = \"OFFLINE\";\nvar dcs = \"\";\n    if(msg.PS.Status.Game.DCS.IsActive) {\n\t\tif(msg.PS.Status.Game.DCS.Responding) {dcsok = `OK`} else {dcsok = `NOT RESPONDING`}\n        dcs = `\n              #### DCS   STATUS ####\n     DCS Server Status : `+dcsok+`\n           DCS Version : `+msg.PS.Status.Game.DCS.ProductVersion+`\n            DCS UpTime : `+pad(msg.PS.Status.Game.DCS.RunTime.Days,2)+ `:`+pad(msg.PS.Status.Game.DCS.RunTime.Hours,2)+`:`+pad(msg.PS.Status.Game.DCS.RunTime.Minutes,2)+`:`+pad(msg.PS.Status.Game.DCS.RunTime.Seconds,2)+`\n  DCS Process Priority : `+GetPriority(msg.PS.Status.Game.DCS.PriorityClass)+`\n    DCS Process Memory : `+msg.PS.Status.Game.DCS.MemGB+`GB   \n     DCS Process Ports : `+msg.PS.Status.Game.DCS.ProcessPorts\n\n        }\n    else {\n        dcs = `\n              #### DCS   STATUS ####\n     DCS Server Status : `+dcsok\n        }\n////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////        \n//SRS            \nvar srsok = \"OFFLINE\";\nvar srs = \"\";\n    if(msg.PS.Status.Game.SRS.IsActive) {\n\t\tif(msg.PS.Status.Game.SRS.Responding) {srsok = `OK`} else {srsok = `NOT RESPONDING`}\n        srs = `\n              #### SRS   STATUS ####\n     SRS Server Status : `+srsok+`\n           SRS Version : `+msg.PS.Status.Game.SRS.ProductVersion+`\n            SRS UpTime : `+pad(msg.PS.Status.Game.SRS.RunTime.Days,2)+ `:`+pad(msg.PS.Status.Game.SRS.RunTime.Hours,2)+`:`+pad(msg.PS.Status.Game.SRS.RunTime.Minutes,2)+`:`+pad(msg.PS.Status.Game.SRS.RunTime.Seconds,2)+`\n  SRS Process Priority : `+GetPriority(msg.PS.Status.Game.SRS.PriorityClass)+`\n    SRS Process Memory : `+msg.PS.Status.Game.SRS.MemGB+`GB\n      SRS Server Ports : `+msg.PS.Status.Game.SRS.ProcessPorts\n        }\n    else {\n        srs = `\n              #### SRS   STATUS ####\n     SRS Server Status : `+srsok\n        }\n\nvar transmit = `Requested by `+responsee+` \\`\\`\\` DETAILED REPORT for ` +DDC2.ServerID+ ` as at ` +localdatetime+`\n `+serverMSG+` \n `+dcs+`\n `+srs+`\n `+dcsUpdate+`\n `+srsUpdate+`\n `+lotUpdate+`\n  \\`\\`\\`*Request completed in `+ttc+`*` \n//LOG/SECTION//////////////////////////////////////////////////////////////////////////\nvar access = \"DENIED\";\nif (msg.message.authorized) {access = \"GRANTED\"}\nvar LogChan = {\n    \"id\": DDC2.Channel.Log\n    }\nvar logmsg = ` \\`\\`\\`    TimeStamp: ` +localdatetime+ `\n     RequestID: `+msg._msgid+`\n     Requestor: `+usrname+ `\n  Request Type: ` +msg.message.request+ `\n       Raw Msg: `+msg.message.raw+`\n     Responder: ` +DDC2.ServerID+ `\n        Access: ` +access+ `\n      Comments: Request completed in `+ttc+`\\`\\`\\` `\nvar logsend = {\n    \"payload\": logmsg,\n    \"channel\": LogChan\n    };\n//TRANSMIT/SECTION/////////////////////////////////////////////////////////////////////\nmsg.payload = transmit\n\nnode.status({fill:\"green\",shape:\"ring\",text: \"Reports Sent: \"+MsgSent});\ncontext.set('MsgSent', (MsgSent + 1));\n\nreturn [[msg],[logsend]];\n}","outputs":2,"noerr":0,"initialize":"","finalize":"","x":1290,"y":720,"wires":[["26937249.88bcee"],["26937249.88bcee"]],"inputLabels":["Powershell Output"],"outputLabels":["Server-Status","Server-Log"],"icon":"node-red/envelope.svg"},{"id":"3c11b840.b78858","type":"function","z":"437000c7.c01d","name":"Set DDC2.VNC","func":"flow.set('DDC2.VNC.Enabled', false);\nflow.set('DDC2.VNC.Port', 'YOUR VNC Port');\nflow.set('DDC2.VNC.Type', 'RealVNC');\n\nnode.status({fill:\"green\",shape:\"dot\",text:\"DDC2.VNC: \" +flow.get('DDC2.VNC.Enabled')});","outputs":0,"noerr":0,"initialize":"","finalize":"","x":620,"y":420,"wires":[],"icon":"node-red/cog.svg"}]
